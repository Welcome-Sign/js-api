/device/content:
  get:
    tags:
      - Device API
    summary: Get device content
    description: |
      Retrieve all content for display on this device.
      Returns content with targeting hierarchy: device-specific > room-specific > property-wide.
      Content is grouped by type for easier frontend consumption.
      Requires device token authentication.
    security:
      - DeviceAuth: []
    responses:
      '200':
        description: Content retrieved successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: integer
                  example: 200
                success:
                  type: string
                  example: "true"
                type:
                  type: string
                  example: array
                data:
                  type: object
                  properties:
                    success:
                      type: boolean
                      example: true
                    device_id:
                      type: string
                      format: uuid
                      example: 550e8400-e29b-41d4-a716-446655440001
                    content:
                      type: object
                      description: Content grouped by type
                      additionalProperties:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            property_id:
                              type: string
                              format: uuid
                            room_id:
                              type: string
                              format: uuid
                              nullable: true
                            device_id:
                              type: string
                              format: uuid
                              nullable: true
                            content_type:
                              type: string
                              example: message
                            data:
                              type: object
                              description: Content-specific data
                            created_at:
                              type: string
                              format: date-time
                            updated_at:
                              type: string
                              format: date-time
                      example:
                        message:
                          - id: "550e8400-e29b-41d4-a716-446655440010"
                            property_id: "550e8400-e29b-41d4-a716-446655440000"
                            room_id: null
                            device_id: null
                            content_type: "message"
                            data:
                              title: "Welcome!"
                              body: "Welcome to our property"
                            created_at: "2025-01-15 10:00:00"
                            updated_at: "2025-01-15 10:00:00"
                        background:
                          - id: "550e8400-e29b-41d4-a716-446655440011"
                            property_id: "550e8400-e29b-41d4-a716-446655440000"
                            room_id: null
                            device_id: null
                            content_type: "background"
                            data:
                              url: "https://cdn.example.com/bg.jpg"
                            created_at: "2025-01-15 10:00:00"
                            updated_at: "2025-01-15 10:00:00"
                    current_booking:
                      type: object
                      nullable: true
                      description: Current active booking for the device context - room-specific if device has room_id, otherwise property-wide (null if no active booking)
                      properties:
                        id:
                          type: string
                          format: uuid
                        property_id:
                          type: string
                          format: uuid
                        room_id:
                          type: string
                          format: uuid
                          nullable: true
                          description: Room ID if this is a room-specific booking
                        guest_name:
                          type: string
                          example: John Doe
                        guest_email:
                          type: string
                          format: email
                        check_in:
                          type: string
                          format: date-time
                          example: "2025-01-15 16:00:00"
                        check_out:
                          type: string
                          format: date-time
                          example: "2025-01-20 10:00:00"
                        num_guests:
                          type: integer
                          example: 2
                        status:
                          type: string
                          enum: [confirmed, in_progress]
                    last_updated:
                      type: string
                      format: date-time
                      description: ISO 8601 timestamp of when this response was generated
                      example: "2025-01-15T10:30:00+00:00"
      '401':
        description: Invalid or missing device token
        content:
          application/json:
            schema:
              $ref: '../schemas/Error.yaml'
            example:
              error: true
              message: Invalid or expired device token
      '500':
        $ref: '../responses/common.yaml#/InternalServerError'

/device/heartbeat:
  post:
    tags:
      - Device API
    summary: Device heartbeat
    description: |
      Update device's own last_seen_at timestamp to indicate it is online.
      Requires device token authentication. Device automatically reports its own status.
    security:
      - DeviceAuth: []
    responses:
      '200':
        description: Heartbeat updated
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: integer
                  example: 200
                success:
                  type: string
                  example: "true"
                type:
                  type: string
                  example: array
                data:
                  type: object
                  properties:
                    success:
                      type: boolean
                      example: true
                    message:
                      type: string
                      example: Device heartbeat updated
                    device_id:
                      type: string
                      format: uuid
                      example: 550e8400-e29b-41d4-a716-446655440001
                    last_seen_at:
                      type: string
                      format: date-time
                      example: '2025-01-15 10:30:00'
      '401':
        description: Invalid or missing device token
        content:
          application/json:
            schema:
              $ref: '../schemas/Error.yaml'
            example:
              error: true
              message: Invalid or expired device token
      '500':
        $ref: '../responses/common.yaml#/InternalServerError'

/device/info:
  get:
    tags:
      - Device API
    summary: Get device information
    description: |
      Retrieve device's own information and associated property details.
      Requires device token authentication. Devices use this to get their configuration.
    security:
      - DeviceAuth: []
    responses:
      '200':
        description: Device information retrieved
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: integer
                  example: 200
                success:
                  type: string
                  example: "true"
                type:
                  type: string
                  example: array
                data:
                  type: object
                  properties:
                    success:
                      type: boolean
                      example: true
                    device:
                      $ref: '../schemas/Device.yaml'
                    property:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        name:
                          type: string
                        phone:
                          type: string
                          description: Property contact phone number
                          example: "5551234567"
                          nullable: true
                        timezone:
                          type: string
                          example: "America/New_York"
                        default_checkin_time:
                          type: string
                          format: time
                          description: Default check-in time
                          example: "16:00:00"
                        default_checkout_time:
                          type: string
                          format: time
                          description: Default check-out time
                          example: "10:00:00"
                        wifi_ssid:
                          type: string
                        wifi_password:
                          type: string
                          description: Decrypted WiFi password for display on device
                          nullable: true
                      nullable: true
      '401':
        description: Invalid or missing device token
        content:
          application/json:
            schema:
              $ref: '../schemas/Error.yaml'
            example:
              error: true
              message: Invalid or expired device token
      '500':
        $ref: '../responses/common.yaml#/InternalServerError'
